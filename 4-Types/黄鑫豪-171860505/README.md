## 面向葫芦娃编程



#### 设计理念

- **TwoDSpace** 二维空间类
  - 故事主要发生在 **TwoDSpace** 这个类所描绘的二维世界中；
  - 该类中含有所有的“生物”和“事件”；
  - 通过 Object 构成的世界的每个元素自我 “describe” 即可得到整个空间的状态；
  - 葫芦娃从初始乱序变有序的过程，复用了作业二中的部分代码；
  - 调用 Formation 中各阵型对应的函数，即可获得一系列 Position 的集合，并以此为依据即可安排葫芦娃、蝎子精及其喽啰按阵列排好；
  - 从靠近葫芦娃一侧和靠近妖精一侧的边缘开始遍历空间，只要有空位（无人站此处）就安排爷爷和蛇精分别站立于那里；
- **Formation** 阵型类
  - 含有长蛇、鹤翼、锋矢三种阵型；
  - 每种具体的阵型中，会用 0/1 矩阵记录下站位，在需要使用时统计好返回位置的集合；
- **Position** 位置类
  - 基本的表示二维空间中位置的类，含有两维度的坐标；
  - Posx 和 Posy 可以被查看和修改；
  - 该类是 TwoDSpace 和 Formation 都依赖的一个基础类；
- **Object** 物件类
  - 是 Creature 生物类和 Nothing 空类的父类；
  - Nothing 即某个位置没有生物时存在的"事物"；
  - 主要用于统一有无生物时的状态，在 TwoDSpace 中构成了整个“世界”；
  - 作为父类，它的指针既可以指向生物，也可以指向“空”，**好处**是这样的多态性质提高了程序的效率；
  - 它们都具有各自的 Position，在被设置到某个位置时，它们会“知道”自己在哪；
  - 它们都可以表述（describe）出自己的“名称”；
- **Creature** 生物类
  - 它的子类有：
    - GourdEva 葫芦娃
    - Grandpa 爷爷
    - EvilFather 蝎子精
    - EvilMother 蛇精
    - EvilSon 小喽啰
  - 它们都可以知道自己的位置 Position，以及自己的名称并作出自我描述 describe();
  - 它们都最初源于 Object 类，所以可以被安置在二维空间 TwoDSpace 类中的二维 Object 指针数组中；



#### UML 类图

根据代码中类的关系描绘的 UML 类图如下：

![](res\UML.png)

#### 泛型与反射机制

程序中有多处使用到**泛型机制**，例如

- Java 容器 List，ArrayList ，用于生成一个存放整形的列表，这里具体将用作生成随机序列；

<img src="res/generics1.jpg">

- 用于生成一个存放整形的序列，接收上述函数产生的整形序列；
<img src="res/generics2.jpg">

- 使用赋予给既有反省特性的类 List 各种类型，去取代原先的简单的数组类型。
<img src="res/generics3.jpg">

- 这里是与前期项目区别比较大的地方，是一个承上启下的环节。先前的 Position 是单纯的用来记录坐标的类，只具有表示横纵坐标的两个成员属性，现在则是将这个类改造成泛型类，且将其成员属性多加一个 holder 用于表示占据了这个位置的生物，这对于项目整体的构造无疑是有优化的作用的，也将会在后续的大作业中体现出来。
<img src="res/generics4.jpg">

而关于**反射机制**，我进行了如下的设计:

只需要一个 describe 函数，就可以利用反射机制，获取根据占据空间的生物类型，直接对其进行描述，绘制战场的情况。这样也无需再保留每个生物类中对自己的 describe 函数，大大简化了代码，提高了复用性和效率。

<img src="res/reflection.jpg">